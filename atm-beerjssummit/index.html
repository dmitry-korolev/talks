<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<base href="../" />

		<title>Через тернии к ATM</title>

		<link rel="stylesheet" href="lib/css/reveal.css">
		<link rel="stylesheet" href="lib/css/theme/moon.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/plugins/prism/night.css">

		<!-- Printing and PDF exports -->
		<script>
			const link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'lib/css/print/pdf.css' : 'lib/css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section>
					<h3>
						<span>Как сдать проект на четыре месяца позже дедлайна и выжить</span>
						<span class="fragment">из компании того человека, из-за которого это произошло</span>
					</h3>
					<p style="line-height: 0.8">
						<small>Дима Королев, разработчик в Tinkoff.ru</small><br />
						<small>email: <a href="mailto:dima@korolev.dk">dima@korolev.dk</a></small><br />
						<small>github: <a href="https://github.com/dmitry-korolev">/dmitry-korolev</a></small><br />
						<small>telegram: <a href="https://t.me/dimakorolev">@dimakorolev</a></small>
					</p>
					<aside class="notes">
						<p>Всем привет. Меня зовут Дима Королев, и я - разработчик в банке Тинькофф.</p>
					</aside>
				</section>

				<section>
					<h1>Интро</h1>
					<aside class="notes">
						<p>Итак, я расскажу вам, короткую, но яркую историю одного разработчика, проработавшего в Тинькофф неполные полгода, и покинувшего компанию по собственному желанию. И занимался этот разработчик банкоматами.</p>
					</aside>
				</section>
				
				<section>
					<h1>Команда</h1>
					<aside class="notes">
						<p>Проект банкоматов появился внутри банка как некий стартап. Это была отдельная небольшая команда: менеджер, несколько технологов, парочка джава-разработчиков, писавших бек, и наш герой - единственный разработчик, писавший фронт.</p>
					</aside>
				</section>

				<section>
					<h1>Web-app</h1>
					<aside class="notes">
						<p>Да, фронт. В качестве основы ПО для банкоматов было взято уже существующее решение, в котором для отображения интерфейса использовалось веб-приложение, запущенное в браузере. Это всех устраивало, потому что это модно, стильно и молодежно, и именно так проще и дешевле всего было сделать оригинальный интерфейс, отвечающий всем потребностям заказчиков.</p>
					</aside>
				</section>
				
				<section>
					<h1>Особенности</h1>
					<aside class="notes">
						<p>Разумеется, нужно понимать, что у разработки веб-приложения под банкоматы могут быть особенности - и они были.</p>
					</aside>
				</section>

				<section>
					<h1>Один клиент</h1>
					<aside class="notes">
						<p>Начнем с плюсов.</p>
						<p>Во-первых, все банкоматы одинаковые.</p>
						<p>У них одинаковое разрешение экрана, один и тот же браузер, одно и то же железо.</p>
						<p>В общем-то, это единственный плюс.</p>
					</aside>
				</section>

				<section>
					<h1>Минусы</h1>
					<aside class="notes">
						<p>Дальше только минусы.</p>
						<p>В качестве браузера использовалась древняя и изрядно перелопаченная версия хромиума</p>
						<p>Кроме того, это было кастомизированный хромиум, что само по себе вызывало странные баги.</p>
					</aside>
				</section>
				
				<section>
					<h1>Debug</h1>
					<aside class="notes">
						<p>Древняя версия браузера вызывала множество проблем, например - крайне унылая отладка из-за принципиальной невозможности залогировать стектрейс.</p>
					</aside>
				</section>

				<section>
					<h1>Эмуляция</h1>
					<aside class="notes">
						<p>Сильное различие боевой среды, тестовой среды и эмулятора, с которым велась непосредственная разработка, вызывали мощнейшие когнитивные искажения, галлюцинации и желание долго и упорно биться головой о стену.</p>
					</aside>
				</section>

				<section>
					<h1>Утечки</h1>
					<aside class="notes">
						<p>А еще нужно было помнить о том, что приложение может быть запущено постоянно, в течение дней и недель, и даже небольшая утечка памяти за то время, пока работает банкомат, может привести (и приводили) к тормозам и падениям. А из-за проблем с дебагом эти утечки было крайне сложно искать.</p>
					</aside>
				</section>
				
				<section>
					<h1>События</h1>
					<aside class="notes">
						<p>Плюс ко всему этому JS API, которое предоставляется приложению, тоже имеет свои особенности, главная из которых (помимо общей кривости) - огромное количество событий.</p>
						<p>По факту, всё общение завязано на огромный зоопарк разных событий. То есть практически любое действие клиента, как то вставка или прикладывание карты, нажатие на кнопки, внесение и забор денег из купюроприемника - всё это десятки разных событий.</p>
					</aside>
				</section>

				<section>
					<h1>Проблемы</h1>
					<aside class="notes">
						<p>Короче говоря, разрабатывать приложение нужно было с учетом вот этих вот всех особенностей. Понимая, как и что ты делаешь. Но это было не про нашего героя.</p>
						<p>Он писал приложение как художник-абстракционист, широкими, смелыми мазками. В качестве вдохновения он использовал парочку туториалов по реакту. В качестве холста он использовал то, что родила команда create-react-app. Вместо кистей у него был набор из реакт-роутера и редакса с единственным редьюсером на всё приложение. Вместо красок - мешанина из знаний джаваскрипта, выхваченных неизвестно из каких источников. О боги, как он писал.</p>
						<p>В какой-то момент руководство его команды поняло, что что-то не так. Они внезапно для себя обнаружили, что спустя несколько месяцев разработки приложение всё еще не очень готово для продакшена. И тогда они, наконец, сообразили обратиться в отдел собственно веб-разработки.</p>
						<p>Короче говоря, когда я пришел в команду, в приложении уже была куча проблем. Из чувства глубокого сострадания к присутствующим я не стану приводить примеры кода, поэтому вам придется поверить мне на слово. Но боги, как же он писал.</p>
					</aside>
				</section>

				<section>
					<h1>God objects</h1>
					<aside class="notes">
						<p>Вся логика была в реакт-компонентах, ставших божественным объектами. Верстать наш герой, кстати, тоже, кстати, не умел, поэтому верстка была заказана в соседнем отделе, и выдана герою в виде готовых html-файлов. Разумеется, никто не стал эту верстку разбивать на компоненты, и в результате за каждый экран приложения отвечал один файл, в котором была вся логика этого экрана, вся его верстка, вообще всё.</p>
					</aside>
				</section>

				<section>
					<h1>Хаос в подписках</h1>
					<aside class="notes">
						<p>Вторая глобальная проблема была связана с уже упомянутыми событиями. Подписчиков были сотни. Подписки сидели на подписках и подписками погоняли. Подписки создавались внутри конструктора, в didMount, в рендере, в других подписках. Когда это всё друг от друга отписывалось говорить вообще страшно.</p>
					</aside>
				</section>

				<section>
					<h1>WTF/min</h1>
					<aside class="notes">
						<p>В совокупности эти две проблемы порождали бесконечное количество багов, часть из которых вскрывались только в редких кейсах (которые на бою были частыми), тяжело отлавливались (помните, что я говорил про дебаггинг?) и вообще чаще вызывали желание повеситься, нежели пытаться их отыскать.</p>
						<p>Говорить о внедрении каких-то н овых фич вообще не приходилось, основные бы запустить.</p>
					</aside>
				</section>

				<section>
					<h1>Рефакторинг</h1>
					<aside class="notes">
						<p>Таким образом, я подвожу к главной проблеме. И состояла она в том, что приложение УЖЕ было, УЖЕ хоть как-то работало и УЖЕ, хоть и постоянно падая, вываливая тонны ошибок, могло проводить какие-то операции. Это означало, что возможности начать с нуля нет, нужно работать с тем, что есть, править баги, переписывать отдельные сценарии и так далее.</p>
						<p>Короче говоря, надо было рефакторить.</p>
					</aside>
				</section>
				
				<section>
					<h1>А что герой?</h1>
					<aside class="notes">
						<p>И всё-таки, это история не про рефакторинг, а про одного конкретного разработчика.</p>
						<p>Разумеется, первое, что нужно было с ним сделать - это мягко дать ему понять, что всё, что он делал последние четыре месяца - это лютая жесть.</p>
						<p>Следующий шаг - помочь разобраться, что именно было не так, и как надо было делать.</p>
						<p>Затем - обучить, поднять, сделать из него нормального человека, ну или хотя бы фронтендера.</p>
					</aside>
				</section>

				<section>
					<h1>Не фартануло</h1>
					<aside class="notes">
						<p>Сразу скажу - ничего из этого не получилось. Любая критика воспринималась в штыки. Любое указание на проблемы отвергалось аргументами типа "так написано в туториале" и "ну работает же".</p>
						<p>К сожалению, с ним так и не удалось найти общий язык, доказать ему, что ему еще многому нужно научиться.</p>
						<p>Собственно, на этом история нашего героя и заканчивается, с ним пришлось расстаться.</p>
					</aside>
				</section>

				<section>
					<h1>Кто виноват?</h1>
					<aside class="notes">
						<p>Об этом можно рассаждать бесконечно.</p>
						<p>Руководитель команды, который, пустил дело на самотек и слишком поздно заметил, что что-то не так?</p>
						<p>Разработчик, который не понимал, что у него из под пера выходит мертворожденный код, и не сообразивший обратиться за помощью?</p>
						<p>Уборщица, которая явно смыслила в джаваскрипте больше, чем этот разработчик, и ни разу не ткнула его носом в ошибки?</p>
					</aside>
				</section>

				<section>
					<h1>Выводы</h1>
					<aside class="notes">
						<p>Ответ на этот вопрос каждый может дать для себя сам, равно как и сделать какие-то выводы из всей этой истории.</p>
						<p>Я только рассказал вам историю, и спасибо, что выслушали. </p>
					</aside>
				</section>
			</div>
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="lib/js/reveal.js"></script>

		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
				controls: false,
				controlsTutorial: false,
				slideNumber: 'c/t',
				history: true,
                transitionSpeed: 'fast',
              	postMessage: true,
				dependencies: [
					{ src: 'lib/plugins/markdown/marked.js' },
					{ src: 'lib/plugins/markdown/markdown.js' },
					{ src: 'lib/plugins/notes/notes.js', async: true },
					{ src: 'lib/plugins/prism/prism.js', async: true, callback: () => {
						Array.from(document.querySelectorAll('pre code')).forEach(block => {
							block.addEventListener('blur', () => {
								Prism.highlightElement(block)
							})
						})
					} }
				]
			})
		</script>
	</body>
</html>
